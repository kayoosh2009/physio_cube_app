<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Physio Cube – Вход</title>
    <link rel="icon" href="https://i.ibb.co/kgKXMwgq/round.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        /* ==================== Стиль (единый с Register) ==================== */
        :root{
            --accent:#0794ae;
            --white:#ffffff;
            --bg-body:#f4f6f8;
            --text:#333333;
            --text-light:#666666;
            --border:#e0e0e0;
        }

        *{ margin:0; padding:0; box-sizing:border-box; }

        body{
            background:var(--bg-body);
            font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            min-height:100vh;
            display:flex;
            justify-content:center;
            align-items:center;
            color:var(--text);
        }

        .card{
            width:100%;
            max-width:380px;
            background:var(--white);
            border:1px solid var(--border);
            border-radius:12px;
            padding:2.5rem 1.5rem;
            box-shadow:0 10px 25px rgba(0,0,0,0.05);
            text-align:center;
        }

        .project-logo{
            max-width:100px;
            width:100%;
            height:auto;
            margin:0 auto 1.5rem;
            display: block;
            border-radius: 50%; /* Опционально: скругляет логотип */
        }

        h2{
            margin-bottom:2rem;
            color:var(--accent);
            font-size:1.8rem;
            font-weight: 700;
        }

        /* Поля ввода */
        .input-group{
            margin-bottom:1rem;
            text-align:left;
        }
        .input-group label{
            display:block;
            margin-bottom:0.3rem;
            font-size:0.9rem;
            color:var(--text-light);
            font-weight: 500;
        }
        .input-group input{
            width:100%;
            padding:0.8rem;
            font-size:1rem;
            border:1px solid #ccc;
            border-radius:8px;
            background: #fafafa;
            transition: all .2s;
        }
        .input-group input:focus{
            outline:none;
            border-color:var(--accent);
            background: #fff;
            box-shadow: 0 0 0 3px rgba(7, 148, 174, 0.1);
        }

        /* --- СТИЛЬ ДЛЯ ССЫЛКИ ЗАБЫЛ ПАРОЛЬ --- */
        .forgot-pass-link {
            text-align: right;
            margin-top: -8px;
            margin-bottom: 15px;
        }
        .forgot-pass-link a {
            color: var(--accent);
            font-size: 0.85rem;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }
        .forgot-pass-link a:hover {
            color: #056e93;
            text-decoration: underline;
        }

        /* Основная кнопка */
        .btn{
            display:block;
            width:100%;
            padding:0.9rem;
            font-size:1.1rem;
            font-weight:bold;
            border-radius:8px;
            cursor:pointer;
            border:none;
            transition:all .2s;
        }
        .btn-primary{
            color:var(--white);
            background:var(--accent);
            box-shadow: 0 4px 6px rgba(7, 148, 174, 0.2);
        }
        .btn-primary:hover{ background:#056e93; transform: translateY(-1px); }
        .btn-primary:active{ transform: scale(0.98); }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; transform: none; }

        /* Разделитель */
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 1.5rem 0;
            color: #999;
            font-size: 0.85rem;
        }
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #e0e0e0;
        }
        .divider:not(:empty)::before { margin-right: .5em; }
        .divider:not(:empty)::after { margin-left: .5em; }

        /* Соц. кнопки */
        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 0.8rem;
            text-decoration: none;
        }

        /* Google */
        .btn-google {
            background: #fff;
            border: 1px solid #ddd;
            color: #333;
        }
        .btn-google:hover { background: #f7f7f7; }
        
        /* Apple */
        .btn-apple {
            background: #000;
            border: 1px solid #000;
            color: #fff;
        }
        .btn-apple:hover { opacity: 0.9; }

        /* Нижние ссылки */
        .extra-links{
            margin-top:1.5rem;
            font-size: 0.9rem;
        }
        .extra-links a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
        }
        .extra-links a:hover { text-decoration: underline; }

        @media (max-width:480px){
            body { background: var(--white); }
            .card{
                border:none; box-shadow:none; border-radius: 0;
                padding: 1.5rem; height: 100vh;
                display: flex; flex-direction: column; justify-content: center;
            }
        }
    </style>
</head>

<body>

    <section class="card">
        <img src="https://i.pinimg.com/736x/b1/21/13/b12113174c4e7e5af8f77a203e67663d.jpg" alt="Логотип Physio Cube" class="project-logo">
        
        <h2>С возвращением</h2>

        <form id="loginForm">
            <div class="input-group">
                <label for="email">Электронная почта</label>
                <input type="email" id="email" required autocomplete="email" placeholder="you@example.com">
            </div>

            <div class="input-group">
                <label for="password">Пароль</label>
                <input type="password" id="password" required autocomplete="current-password" placeholder="••••••••">
            </div>

            <div class="forgot-pass-link">
                <a href="#" id="forgotPasswordBtn">Забыли пароль?</a>
            </div>

            <button type="submit" class="btn btn-primary" id="loginBtn">Войти</button>
        </form>

        <div class="divider">или войти через</div>

        <button type="button" class="social-btn btn-google" id="googleBtn">
            <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.562 2.684-3.875 2.684-6.615z" fill="#4285F4"/>
                <path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.836.86-3.048.86-2.344 0-4.328-1.584-5.036-3.715H.957v2.332A8.997 8.997 0 0 0 9 18z" fill="#34A853"/>
                <path d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
                <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.27C4.672 5.14 6.656 3.58 9 3.58z" fill="#EA4335"/>
            </svg>
            Google
        </button>

        <button type="button" class="social-btn btn-apple" id="appleBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.74 1.18 0 2.05-1.02 3.65-.75 2.5.18 3.75 1.76 3.86 1.83-.03.04-2.4 1.37-2.33 4.14.07 3.32 3 4.44 3.03 4.46-.03.07-.46 1.58-1.51 3.08-.94 1.35-1.92 2.7-3.07 2.7zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.16 2.29-2.03 4.2-3.74 4.25z"/>
            </svg>
            Apple
        </button>

        <div class="extra-links">
            <p>Нет аккаунта? <a href="register.html">Зарегистрироваться</a></p>
            <p style="margin-top:0.5rem;"><a href="../main.html">Назад на главную</a></p>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // Добавили sendPasswordResetEmail в импорт
        import { getAuth, signInWithEmailAndPassword, GoogleAuthProvider, OAuthProvider, signInWithPopup, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Конфигурация
        const firebaseConfig = {
            apiKey: "AIzaSyB8DZm6yDyGHD9rWo-bIhsipsKeMXCTcBk",
            authDomain: "physio-cube.firebaseapp.com",
            projectId: "physio-cube",
            storageBucket: "physio-cube.firebasestorage.app",
            messagingSenderId: "593288932552",
            appId: "1:593288932552:web:3b4783b6c16fef9eae09fd",
            measurementId: "G-F5W17MVEZD"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // 1. ЛОГИКА ОБЫЧНОГО ВХОДА (Email/Pass)
        const loginForm = document.getElementById('loginForm');
        const loginBtn  = document.getElementById('loginBtn');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loginBtn.disabled = true;
            loginBtn.textContent = 'Выполняется вход...';

            const email    = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                // Успех → dash.html
                window.location.href = "../dash.html";
            } catch (error) {
                console.error(error);
                alert("Неправильный адрес электронной почты или пароль.");
                loginBtn.disabled = false;
                loginBtn.textContent = 'Войти';
            }
        });

        // 4. ЛОГИКА ВОССТАНОВЛЕНИЯ ПАРОЛЯ (НОВОЕ)
        const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');

        forgotPasswordBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value.trim();

            if (!email) {
                alert("Пожалуйста, введите ваш электронный адрес в поле выше, затем нажмите «Забыли пароль?» ещё раз.");
                return;
            }

            try {
                await sendPasswordResetEmail(auth, email);
                alert("Письмо для сброса пароля отправлено! Проверьте ваш почтовый ящик.");
            } catch (error) {
                console.error("Reset Password Error:", error);
                let message = "Ошибка отправки письма для сброса пароля: " + error.message;
                if (error.code === 'auth/user-not-found') message = "Пользователь с таким email не найден.";
                alert(message);
            }
        });

        // 2. ЛОГИКА GOOGLE ВХОДА
        const googleBtn = document.getElementById('googleBtn');

        googleBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                // Успех → dash.html
                window.location.href = "../dash.html";
            } catch (error) {
                console.error("Google login error:", error);
                alert("Не удалось войти через Google: " + error.message);
            }
        });

        // 3. ЛОГИКА APPLE ВХОДА
        const appleBtn = document.getElementById('appleBtn');

        appleBtn.addEventListener('click', async () => {
            const provider = new OAuthProvider('apple.com');
            provider.addScope('email');
            provider.addScope('name');

            try {
                await signInWithPopup(auth, provider);
                // Успех → dash.html
                window.location.href = "../dash.html";
            } catch (error) {
                console.error("Apple login error:", error);
                alert("Не удалось войти через Apple: " + error.message);
            }
        });

    </script>

</body>
</html>
